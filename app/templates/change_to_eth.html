{% extends "base.html" %} {% block content %} {% if has_access_to_sell %}
<form action="" method="post" novalidate class="form small_card_container">
  <p style="text-align: center; width: 100%">
    <i id="status_message"></i>
  </p>
  {% with messages = get_flashed_messages() %} {% if messages %}
  <p style="text-align: center; width: 100%">
    <i id="flash_msg">{{ messages[0] }}</i>
  </p>
  {% endif %} {% endwith %} {{ form.csrf_token() }} {{ form.hidden_tag() }}
  <div class="small_card_flex" style="width: 60%; margin-left: 20%">
    <div class="info_card" style="min-width: 33%">
      <div class="info_card_text_block">
        <p class="info_card_text"><b>Баланс токенов вклада:</b></p>
        <p class="info_card_text green">{{ ktd_balance }}</p>
      </div>
      <div class="info_card_text_block">
        <p class="info_card_text"><b>Курс токена вклада:</b></p>
        <p class="info_card_text green">
          1 КТ = <span id="price">{{ ktd_price }}</span> eth
        </p>
      </div>
    </div>

    <div class="input_eth_container">
      <div class="dark_block">
        <p class="info_card_text"><b>Сколько токенов обменять?</b></p>
        {{ form.amount(size=256, class_="eth_input" ) }}
      </div>
      <div class="dark_block">
        <p class="info_card_text"><b>Вы получите:</b></p>
        <p class="info_card_text blue" id="total">0 eth</p>
      </div>
      {{ form.submit(class_="submit") }}
    </div>
  </div>
</form>
{% else %}
<div class="intro">
  <div class="container">
    <h1 class="intro_title">У вас нет доступа к обмену токенов вклада.</h1>
  </div>
</div>
{% endif %}
<script>
  'use strict';

  const output = document.querySelector('#total');
  const input = document.querySelector('.eth_input');
  const price = document.querySelector('#price');
  const flashMessage = document.querySelector('#flash_msg');

  input.addEventListener('input', (event) => {
    const amount = isFinite(event.target.value) ? event.target.value : 0;

    output.textContent = `${amount * price.textContent} eth`;
  });

  const submit = document.querySelector('#submit');
  const statusMessage = document.querySelector('#status_message');

  submit.addEventListener('click', () => {
    statusMessage.textContent = 'Получаем разрешение на использование токенов';

    if (flashMessage) {
      flashMessage.textContent = '';
    }
  });
</script>

{% endblock %}
