{% extends "base.html" %}

{% block scripts %}
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
<script src="{{url_for('static', filename='js/service.js')}}"></script>
{% endblock %}

{% block content %}
<div class="nav_href" style="margin-top:2vh; margin-left:10%;">
        {% if not is_preview %}
            <a href="/">главная</a> - <a href="/community">сообщество</a> - <a href="/services">услуги</a> - <a class="cur_href" href="">информация об услуге</a>
        {% else %}
            <span>Превью услуги</span>
        {% endif %}
    </div>
<form class="service_page_container" method="post">
    {{ form.hidden_tag() }}
    <div class="service_page_content" ng-app="app" ng-controller="ctrl" ng-init="init({{service['price']}});" ng-cloak>
        <div class="service_page_title">
            Услуга: &ldquo;{{service['name']}}&rdquo;
        </div>
        <div class="service_page_text">
            <p>
                <b>Стоимость</b>: {{service['price']}} Токенов Вклада за 1 {{service['unit']}}
            </p>
            <p>
                <b>Описание</b>: {{service['description']}}
            </p>
            <p>
                <b>Срок действия услуги</b>: {{service['days_to_expire']}} {{ days_to_expire_label }} после оплаты
            </p>
            <p>
                Какое количество хотите оплатить?<br>
                <input style="width:20%;" name="amount" required ng-model="amount" ng-change="change_amount();">
            </p>
            <div class="service_summary">
                {% raw %}
                <p>Сумма к оплате: <span class="service_page_tokens">{{res}}</span> Токенов Вклада</p>
                {% endraw %}
                <p>Услугу предоставляет: {{ service['service_provider'] }}</p>
            </div>
        </div>
        <div class="service_page_buttons_container">
            <button class="service_page_button" type="{{ 'button' if is_preview else 'submit' }}" id="button" disabled>Подтвердить</button>

            {% if current_user.id == service['creator_id'] %}
                <button class="service_page_button"  type="button" id="delete">Удалить услугу</button>
            {% endif %}
        </div>
        {% if is_preview %}
            <div class="service_page_buttons_container" style="margin-top: 2rem">
                <button class="service_page_button" type="button" onclick="window.history.back();">Назад</button>
            </div>
        {% endif %}
    </div>
</form>
<form method="post">
    <div
        class="standard-modal-layout standard-disabled-modal-layout"
        id="confirmation-modal-layout"
    >
        <div class="standard-modal standard-disabled-modal service_page_remove_modal" id="confirmation-modal">
            <h4 class="standard-modal-title" style="text-transform: none">Вы уверены, что хотите удалить услугу?</h4>
            <div class="standard-modal-form-group">
                <span>Вся подробная информация об услуге будет безвозвратно удалена</span>
            </div>
            <div class="flex-between">
               <button class="standard-black-button" type="submit" name="submit" value="delete">Подтвердить</button>
               <button class="standard-black-button" type="button" id="cancel-button">
                   Отменить
               </button>
            </div>
        </div>
    </div>
</form>

<script>
    'use strict';

    const deleteButton = document.querySelector('#delete');

    const confirmationModalLayout = document.querySelector('#confirmation-modal-layout');
    const confirmationModal = document.querySelector('#confirmation-modal');

    deleteButton.addEventListener('click', () => {
        confirmationModalLayout.classList.remove('standard-disabled-modal-layout');
        confirmationModal.classList.remove('standard-disabled-modal');
    });

    const cancelButton = document.querySelector('#cancel-button');
    cancelButton.addEventListener('click', () => {
        confirmationModalLayout.classList.add('standard-disabled-modal-layout');
        confirmationModal.classList.add('standard-disabled-modal');
    });
</script>
{% endblock %}
